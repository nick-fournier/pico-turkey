<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <title>Turkey Temperature!</title>
</head>
<body>

<div id="time-series-plot"></div>

<script>
  function updatePlot() {
    // Fetch JSON data with fields "timestamp" and "temperature" from the server
    fetch('192.168.220.121/data') // Replace with your server endpoint
      .then(response => response.json())
      .then(jsonData => {
        // Convert timestamp strings to JavaScript Date objects
        jsonData.forEach(function (entry) {
          entry.timestamp = new Date(entry.timestamp);
        });

        // Extract timestamps and temperatures from JSON
        var timestamps = jsonData.map(function (entry) {
          return entry.timestamp;
        });

        var temperatures = jsonData.map(function (entry) {
          return entry.temperature;
        });

        // Forecast temperature for the next 10 minutes (simple example)
        var forecastTimestamps = [];
        var forecastTemperatures = [];

        var lastTimestamp = timestamps[timestamps.length - 1];
        var lastTemperature = temperatures[temperatures.length - 1];
        for (var i = 1; i <= 10; i++) {
          var forecastTimestamp = new Date(lastTimestamp.getTime() + i * 60 * 1000);
          var forecastTemperature = lastTemperature + i; // Simple forecast (replace with your forecasting logic)

          forecastTimestamps.push(forecastTimestamp);
          forecastTemperatures.push(forecastTemperature);
        }

        // Create the time series mountain plot
        var trace = {
          x: timestamps,
          y: temperatures,
          type: 'scatter',
          mode: 'lines',
          fill: 'tozeroy',
          line: {
            color: 'rgb(0, 100, 255)',
          },
          name: 'Actual Temperature',
        };

        // Create the forecast trace
        var forecastTrace = {
          x: timestamps.concat(forecastTimestamps),
          y: temperatures.concat(forecastTemperatures),
          type: 'scatter',
          mode: 'lines',
          line: {
            color: 'rgb(255, 0, 0)',
          },
          name: 'Forecasted Temperature',
        };

        var layout = {
          title: 'Turkey Temperature!',
          xaxis: {
            title: 'Timestamp',
            tickformat: '%I:%M %p', // Format as HH:MM in 12-hour format
          },
          yaxis: {
            title: 'Temperature',
          },
        };

        var data = [trace, forecastTrace];

        // Use Plotly to create or update the plot
        Plotly.newPlot('time-series-plot', data, layout);
      })
      .catch(error => console.error('Error fetching data:', error));
  }

  // Call the updatePlot function initially
  updatePlot();

  // Set up an interval to update the plot every 5 seconds
  setInterval(updatePlot, 5000);
</script>

</body>
</html>
